(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a2df0e3","chunk-411e9831","chunk-04c7e2bd","chunk-2d0c5794","chunk-2d0b61e5"],{"1c96":function(e,t,r){"use strict";r.r(t);var n=r("a34a"),a=r.n(n),s=r("dfd8");r("f121");function i(e,t,r,n,a,s,i){try{var o=e[s](i),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function o(e){i(s,n,a,o,u,"next",e)}function u(e){i(s,n,a,o,u,"throw",e)}o(void 0)})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}var p=function(){function e(){u(this,e)}return l(e,[{key:"importCustomerLog",value:function(){var e=o(a.a.mark(function e(t){var r,n;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r={},t&&t["raw"]){e.next=3;break}return e.abrupt("return");case 3:return r["file"]=t["raw"],e.next=6,Object(s["post"])("v1/excel/customer_log",r,{handleError:!0});case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"importCustomer",value:function(){var e=o(a.a.mark(function e(t){var r,n;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r={},t&&t["raw"]){e.next=3;break}return e.abrupt("return");case 3:return r["file"]=t["raw"],e.next=6,Object(s["post"])("v1/excel/customer",r,{handleError:!0});case 6:return n=e.sent,console.log(n),e.abrupt("return",n);case 9:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"exportCustomer",value:function(){var e=o(a.a.mark(function e(){var t,r,n=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],e.next=3,Object(s["get"])("v1/excel/customer",{ids:t,handleError:!0});case 3:return r=e.sent,console.log(r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"exportCustomerLog",value:function(){var e=o(a.a.mark(function e(){var t,r,n=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],e.next=3,Object(s["get"])("v1/excel/customer_log",{ids:t,handleError:!0});case 3:return r=e.sent,console.log(r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}]),e}();t["default"]=new p},"2a62":function(e,t,r){"use strict";r("d7fb")},"3ef2":function(e,t,r){"use strict";r.r(t);var n=r("a34a"),a=r.n(n),s=r("dfd8"),i=r("f121");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(r,!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r,n,a,s,i){try{var o=e[s](i),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function i(e){l(s,n,a,i,o,"next",e)}function o(e){l(s,n,a,i,o,"throw",e)}i(void 0)})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}var h=function(){function e(){f(this,e)}return d(e,[{key:"getCustomers",value:function(){var e=p(a.a.mark(function e(){var t,r,n,o,c,l=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:0,r=l.length>1&&void 0!==l[1]?l[1]:{},n=l.length>2&&void 0!==l[2]?l[2]:i["default"].pageSize,o=u({page:t,count:n},r,{handleError:!0}),e.next=6,Object(s["get"])("v1/customer",o);case 6:return c=e.sent,e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getAllCustomers",value:function(){var e=p(a.a.mark(function e(){var t,r,n,o,c=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:0,r=c.length>1&&void 0!==c[1]?c[1]:{},n=c.length>2&&void 0!==c[2]?c[2]:i["default"].pageSize,e.next=5,Object(s["get"])("v1/customer/all",u({page:t,count:n},r,{handleError:!0}));case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"updateCustomersEntryPublic",value:function(){var e=p(a.a.mark(function e(){var t,r,n=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],e.next=3,Object(s["put"])("v1/customer/public/release",{ids:t});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getPublicAllCustomers",value:function(){var e=p(a.a.mark(function e(){var t,r,n,o=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:0,r=o.length>1&&void 0!==o[1]?o[1]:i["default"].pageSize,e.next=4,Object(s["get"])("v1/customer/public/all",{page:t,count:r,handleError:!0});case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getPublicSetCustomers",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["put"])("v1/customer/public/set",{cutomer_id:t},{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["get"])("v1/customer/".concat(t),{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCustomerByLinkCode",value:function(){var e=p(a.a.mark(function e(){var t,r,n=arguments;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:0,e.next=3,Object(s["get"])("v1/customer/link_code/".concat(t),{handleError:!0});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"addCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["post"])("v1/customer",t,{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"editCustomer",value:function(){var e=p(a.a.mark(function e(t,r){var n;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["put"])("v1/customer/".concat(t),r,{handleError:!0});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"delCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["_delete"])("v1/customer",{ids:t});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateMainCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["put"])("v1/customer/main",t,{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateFollowCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["put"])("v1/customer/follow",t,{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateFollowCustomer",value:function(){var e=p(a.a.mark(function e(t){var r;return a.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["put"])("v1/customer/follow",t,{handleError:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()}]),e}();t["default"]=new h},"5fda":function(e,t,r){},"7fc9":function(e,t,r){},cd2a:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("div",{staticClass:"title"},[e._v("编辑客户日志 "),r("span",{staticClass:"back",on:{click:function(t){return e.back(!1)}}},[r("i",{staticClass:"iconfont icon-fanhui"}),e._v(" 返回 ")])]),r("div",{staticClass:"wrap"},[r("el-row",[r("el-col",{attrs:{lg:16,md:20,sm:24,xs:24}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"status-icon":"",rules:e.rules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"日志名",prop:"name"}},[r("el-input",{attrs:{size:"medium",placeholder:"请填写日志名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"图片信息",prop:"img_urls"}},[r("upload-imgs",{ref:"uploadImgs",attrs:{multiple:!0,rules:e.imgRules,value:e.responseImg(e.form.img_urls),sortable:!0,maxNum:20}})],1),r("el-form-item",{attrs:{label:"日志状态",prop:"status"}},[r("el-select",{attrs:{size:"medium",filterable:"",placeholder:"请选择日志状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[e._l(e.statusData,function(t,n){return[r("el-option",{key:t,attrs:{value:t,label:t,disabled:e.displayStatus!=t?void 0:""}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(n+1))]),r("span",[e._v(e._s(t))])])]})],2)],1),r("el-form-item",{attrs:{label:"交流方式",prop:"commun_type"}},[r("el-select",{attrs:{size:"medium",filterable:"",placeholder:"请选择交流方式"},model:{value:e.form.commun_type,callback:function(t){e.$set(e.form,"commun_type",t)},expression:"form.commun_type"}},[e._l(e.communtypeData,function(t,n){return[r("el-option",{key:t,attrs:{value:t,label:t}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(n+1))]),r("span",[e._v(e._s(t))])])]})],2)],1),r("el-form-item",{attrs:{label:"项目列表",prop:"project_id"}},[r("el-select",{attrs:{size:"medium",filterable:"",disabled:"{!!projectID}",placeholder:"请选择项目"},model:{value:e.form.project_id,callback:function(t){e.$set(e.form,"project_id",t)},expression:"form.project_id"}},[r("el-option",{key:"",attrs:{value:0,label:"日常维护"}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v("00")]),r("span",[e._v("日常维护")])]),e._l(e.projectData,function(t){return[r("el-option",{key:t.id,attrs:{value:t.id,label:t.name}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(t.id))]),r("span",[e._v(e._s(t.name))])])]})],2)],1),r("el-form-item",{attrs:{label:"日志内容",prop:"content"}},[r("editor",{attrs:{id:"tinymce",init:e.editInit},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-form-item",{staticClass:"submit"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("保 存")]),r("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("重 置")])],1)],1)],1)],1)],1)])},a=[],s=r("a34a"),i=r.n(s),o=(r("e562"),r("030f"),r("ca72")),u=(r("ec27"),r("e0ba")),c=r("ae02"),l=r("306b"),p=r("93c2"),f=r("f121"),m=r("f8fd");function d(e){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t,r,n,a,s,i){try{var o=e[s](i),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,a)}function v(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function i(e){h(s,n,a,i,o,"next",e)}function o(e){h(s,n,a,i,o,"throw",e)}i(void 0)})}}var b={name:"CustomerLogEdit",props:{editID:Number,projectID:Number,linkCode:Number},data:function(){return{content:"",fieldObj:{commun_type:"communtypeData"},statusData:["初步联系","见面拜访","停滞客户","成交客户","正式报价"],communtypeData:["见面拜访","微信","钉钉"],projectData:[],displayStatus:f["default"].followStatusExamine,editInit:{selector:"#tinymce",language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",height:"400px",skin_url:"/tinymce/skins/ui/oxide"},value:"",imgRules:{minWidth:100,minHeight:100,maxSize:5},loading:!1,columnData:[],cateData:[],form:{name:"",content:""},rules:{name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],content:[{required:!0,message:"请输入日志内容",trigger:"blur"}]}}},components:{UploadImgs:u["default"],Editor:o["a"]},created:function(){this._initialize(),this.getTypes(),this.getProjects()},methods:{_initialize:function(){this.getCustomerLog()},getCustomerLog:function(){var e=v(i.a.mark(function e(){var t;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,c["default"].getCustomerLog(this.editID);case 4:t=e.sent,this.projectID&&(t.project_id=this.projectID),this.form=t,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.back(!1);case 12:this.loading=!1;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));function t(){return e.apply(this,arguments)}return t}(),submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=v(i.a.mark(function e(r){var n,a,s,o;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=32;break}return t.loading=!0,e.prev=2,e.next=5,t.$refs.uploadImgs.getValue();case 5:return n=e.sent,t.form["img_urls"]=l["default"].solveUploadMultipleImg(n),e.next=9,c["default"].editCustomerLog(t.editID,t.form);case 9:a=e.sent,0===a.error_code&&(t.$message.success("".concat(a.msg)),t.back()),e.next=29;break;case 13:if(e.prev=13,e.t0=e["catch"](2),!e.t0.data){e.next=28;break}if(s=e.t0.data.msg,!s||"object"!==d(s)){e.next=26;break}e.t1=i.a.keys(s);case 19:if((e.t2=e.t1()).done){e.next=26;break}return o=e.t2.value,t.$message.error(s[o]),e.next=24,setTimeout(function(){},1e3);case 24:e.next=19;break;case 26:e.next=29;break;case 28:t.$message.error(e.t0.toString());case 29:t.loading=!1,e.next=34;break;case 32:return t.$message.error("请填写正确的信息"),e.abrupt("return",!1);case 34:case"end":return e.stop()}},e,null,[[2,13]])}));return function(t){return e.apply(this,arguments)}}())},setStatusTypeField:function(){this.projectID?this.fieldObj["status"]="statusData":this.fieldObj["follow_status"]="statusData"},getTypes:function(){var e=v(i.a.mark(function e(){var t,r,n,a,s,o,u=this;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(n in setStatusTypeField(),t=[],r=this.fieldObj,r)t.push(n);return t=t.join(),e.next=7,p["default"].getTypeByField(t);case 7:if(a=e.sent,a&&0!=a.length){e.next=10;break}return e.abrupt("return");case 10:for(o in s=function(e){var t=r[e],n=a.find(function(t){return t["field"]==e});n&&(u[t]=n["value"])},r)s(o);case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getProjects:function(){var e=v(i.a.mark(function e(){var t,r,n=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:0,!(this.linkCode<=0)){e.next=4;break}return this.$message({type:"success",message:"客户错误"}),e.abrupt("return");case 4:return e.next=6,m["default"].getCustomerProjects(t,{},this.linkCode,0,20);case 6:if(r=e.sent,!(r.total_nums<=0)){e.next=10;break}return this.projectData=[],e.abrupt("return");case 10:this.projectData=r.collection;case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),resetForm:function(e){this.$refs[e].resetFields()},back:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$emit("close",e)},responseImg:function(e){if(e&&"undefined"!=e)return l["default"].solveReponseMultipleImg(e)}}},g=b,y=(r("2a62"),r("2877")),x=Object(y["a"])(g,n,a,!1,null,"6e524a24",null);t["default"]=x.exports},cd57:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",["list"===e.redirectType?r("div",{staticClass:"container"},[r("div",{staticClass:"header"},[r("div",{staticClass:"title"},[r("span",[e._v("客户日志列表")]),e.hideLogBtn?e._e():r("div",{staticClass:"log-action-btn"},[r("el-button",{staticClass:"add-banner-item",attrs:{type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("添加客户日志")])],1)]),r("span",{staticClass:"back",on:{click:function(t){return e.back(!1)}}},[r("i",{staticClass:"iconfont icon-fanhui"}),e._v(" 返回 ")])]),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"block"},[r("el-timeline",e._l(e.tableData,function(t,n){return r("el-timeline-item",{key:n,attrs:{timestamp:e._f("dataFormal")(t.create_time),placement:"top"}},[r("el-card",[r("div",{staticClass:"log-block"},[r("div",{staticClass:"log-content"},[r("div",{staticClass:"log-wrap"},[r("h4",{staticClass:"tit"},[e._v(e._s(t.name))]),r("p",{staticClass:"desc",domProps:{innerHTML:e._s(t.content)}})]),r("div",{staticClass:"imgs-upload-container"},e._l(t.img_urls,function(n,a){return r("div",{key:a,staticClass:"img-box",on:{click:function(r){return e.preview(t.id,a)}}},[r("el-image",{staticClass:"thumb-item-img",staticStyle:{width:"100%",height:"100%"},attrs:{src:n.src,fit:"cover"}}),r("div",{staticClass:"control"},[r("div",{staticClass:"preview"},[r("i",{staticClass:"el-icon-view"})])])],1)}),0),r("p",{staticClass:"author-label"},[e._v(e._s(t.author)+" 提交于 "+e._s(t.create_time))])]),e.hideLogBtn?e._e():r("div",{staticClass:"action-wrap"},[r("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(r){return e.handleEdit(t.id)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(r){return e.handleDelete(t.id)}}},[e._v("删除")])],1)])])],1)}),1),0!=e.tableData.length||e.loading?e._e():r("div",{staticClass:"result-wrap"},[e._v("暂无数据")])],1)]):"add"===e.redirectType?r("customer-log-add",{attrs:{userCode:e.userCode,projectID:e.projectID,linkCode:e.linkCode,customerID:e.customerID},on:{close:e.closePage}}):"edit"===e.redirectType?r("customer-log-edit",{attrs:{linkCode:e.linkCode,projectID:e.projectID,editID:e.editID},on:{close:e.closePage}}):e._e()],1)},a=[],s=r("a34a"),i=r.n(s),o=r("ea6d"),u=r("cd2a"),c=r("ae02"),l=r("1c96"),p=r("3ef2"),f=r("4360");function m(e){return m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function d(e,t,r,n,a,s,i){try{var o=e[s](i),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,a)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function i(e){d(s,n,a,i,o,"next",e)}function o(e){d(s,n,a,i,o,"throw",e)}i(void 0)})}}var v={props:{userCode:{type:String,default:""},projectID:Number,hideLogBtn:Boolean,linkCode:{type:Number,default:0}},filters:{dataFormal:function(e){if(!e)return"";var t=e.split(" ");return t.length>=1?t[0]:""}},data:function(){return{redirectType:"list",loading:!0,tableData:[],fileList:[],editID:1,entryType:"customer",customerID:0,pagination:{pageTotal:0},urls:{},thumbs:{}}},components:{CustomerLogAdd:o["default"],CustomerLogEdit:u["default"]},created:function(){this.getCustomerLogs(),this.getCustomerID()},methods:{importCustomerLog:function(){var e=h(i.a.mark(function e(t){var r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,l["default"].importCustomerLog(t);case 3:r=e.sent,this.loading=!1,0===r.error_code&&this.$message({type:"success",message:"".concat(r.msg)});case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),handleChange:function(){var e=h(i.a.mark(function e(t,r){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.importCustomerLog(t);case 2:case"end":return e.stop()}},e,this)}));function t(t,r){return e.apply(this,arguments)}return t}(),solveImgPreview:function(){this.urls={},this.thumbs={};var e={},t=[];this.tableData.length<=0||(this.tableData.forEach(function(r){t=[],r.img_urls&&(r.img_urls.forEach(function(e){t.push(e.src)}),e["id"+r.id]=t)}),this.thumbs=this.urls=e)},getCustomerLogs:function(){var e=h(i.a.mark(function e(){var t,r,n,a,s,o=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:0,this.loading=!0,r={},this.userCode&&0!=this.userCode&&(r["user_code"]=this.userCode),this.projectID>0&&(r["project_id"]=this.projectID),n={},e.prev=6,"super"!=f["default"].state.user.username&&!f["default"].state.auths.includes("获取全部客户信息")){e.next=13;break}return e.next=10,c["default"].getAllCustomerLogs(r,t);case 10:n=e.sent,e.next=16;break;case 13:return e.next=15,c["default"].getCustomerLogs(r,t);case 15:n=e.sent;case 16:if(!(n&&n.total_nums<=0)){e.next=20;break}return this.tableData=[],this.loading=!1,e.abrupt("return");case 20:this.pagination.pageTotal||(this.pagination={pageTotal:n.total_nums}),this.tableData=n.collection,this.solveImgPreview(),this.loading=!1,e.next=44;break;case 26:if(e.prev=26,e.t0=e["catch"](6),this.tableData=[],this.loading=!1,!e.t0.data){e.next=43;break}if(a=e.t0.data.msg,!a||"object"!==m(a)){e.next=41;break}e.t1=i.a.keys(a);case 34:if((e.t2=e.t1()).done){e.next=41;break}return s=e.t2.value,this.$message.error(a[s]),e.next=39,setTimeout(function(){},1e3);case 39:e.next=34;break;case 41:e.next=44;break;case 43:this.$message.error(e.t0.toString());case 44:case"end":return e.stop()}},e,this,[[6,26]])}));function t(){return e.apply(this,arguments)}return t}(),getCustomerID:function(){var e=h(i.a.mark(function e(){var t;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getCustomer(this.linkCode);case 2:t=e.sent,t&&(this.customerID=t["id"],this.userCode=t["user_code"]);case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getCustomer:function(){var e=h(i.a.mark(function e(t){var r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p["default"].getCustomerByLinkCode(t);case 3:return r=e.sent,e.abrupt("return",{id:r.id,user_code:r.user_code});case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));function t(t){return e.apply(this,arguments)}return t}(),currentChange:function(e){e<=0||(e-=1,this.currentPage=e+1,this.getCustomerLogs(e))},preview:function(e,t){this.thumbs=this.urls["id"+e],this.$imagePreview({images:this.urls["id"+e],index:t})},handleAdd:function(){0!=this.customerID?this.redirectType="add":this.$message({type:"error",message:"未选中客户，无法添加日志"})},handleEdit:function(e){this.redirectType="edit",console.log(e),this.editID=e},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该客户日志, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(h(i.a.mark(function r(){var n;return i.a.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,c["default"].delCustomerLog(e);case 3:n=r.sent,t.loading=!1,0===n.error_code&&(t.getCustomerLogs(t.currentPage-1),t.$message({type:"success",message:"".concat(n.msg)}));case 6:case"end":return r.stop()}},r)})))},back:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$emit("close",e)},closePage:function(e){this.redirectType="list",e&&this.getCustomerLogs(this.currentPage-1)}}},b=v,g=(r("da5c"),r("2877")),y=Object(g["a"])(b,n,a,!1,null,"294963b0",null);t["default"]=y.exports},d47c:function(e,t,r){"use strict";r("5fda")},d7fb:function(e,t,r){},da5c:function(e,t,r){"use strict";r("7fc9")},ea6d:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("div",{staticClass:"title"},[e._v("添加客户日志 "),r("span",{staticClass:"back",on:{click:function(t){return e.back(!1)}}},[r("i",{staticClass:"iconfont icon-fanhui"}),e._v(" 返回 ")])]),r("div",{staticClass:"wrap"},[r("el-row",[r("el-col",{attrs:{lg:16,md:20,sm:24,xs:24}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"status-icon":"",rules:e.rules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"日志名",prop:"name"}},[r("el-input",{attrs:{size:"medium",placeholder:"请填写日志名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"图片信息",prop:"img_urls"}},[r("upload-imgs",{ref:"uploadImgs",attrs:{multiple:!0,rules:e.imgRules,maxNum:20}})],1),r("el-form-item",{attrs:{label:"日志状态",prop:"status"}},[r("el-select",{attrs:{size:"medium",filterable:"",placeholder:"请选择日志状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[e._l(e.statusData,function(t,n){return[r("el-option",{key:t,attrs:{value:t,label:t,disabled:e.displayStatus!=t?void 0:""}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(n+1))]),r("span",[e._v(e._s(t))])])]})],2)],1),r("el-form-item",{attrs:{label:"交流方式",prop:"commun_type"}},[r("el-select",{attrs:{size:"medium",filterable:"",placeholder:"请选择交流方式"},model:{value:e.form.commun_type,callback:function(t){e.$set(e.form,"commun_type",t)},expression:"form.commun_type"}},[e._l(e.communtypeData,function(t,n){return[r("el-option",{key:t,attrs:{value:t,label:t}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(n+1))]),r("span",[e._v(e._s(t))])])]})],2)],1),r("el-form-item",{attrs:{label:"项目列表",prop:"project_id"}},[r("el-select",{attrs:{size:"medium",filterable:"",disabled:!0,placeholder:"日常维护"},model:{value:e.form.project_id,callback:function(t){e.$set(e.form,"project_id",t)},expression:"form.project_id"}},[r("el-option",{key:"",attrs:{value:0,label:"日常维护"}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v("00")]),r("span",[e._v("日常维护")])]),e._l(e.projectData,function(t){return[r("el-option",{key:t.id,attrs:{value:t.id,label:t.name}},[r("span",{staticStyle:{color:"#b4b4b4","margin-right":"15px","font-size":"12px"}},[e._v(e._s(t.id))]),r("span",[e._v(e._s(t.name))])])]})],2)],1),r("el-form-item",{attrs:{label:"日志内容",prop:"content"}},[r("editor",{attrs:{id:"tinymce",init:e.editInit},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-form-item",{staticClass:"submit"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("保 存")]),r("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("重 置")])],1)],1)],1)],1)],1)])},a=[],s=r("a34a"),i=r.n(s),o=(r("e562"),r("030f"),r("ca72")),u=(r("ec27"),r("e0ba")),c=r("ae02"),l=r("306b"),p=r("93c2"),f=r("f121"),m=r("f8fd");function d(e){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t,r,n,a,s,i){try{var o=e[s](i),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,a)}function v(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function i(e){h(s,n,a,i,o,"next",e)}function o(e){h(s,n,a,i,o,"throw",e)}i(void 0)})}}var b={name:"CustomerLogAdd",props:{customerID:Number,projectID:Number,linkCode:Number,userCode:String},components:{UploadImgs:u["default"],Editor:o["a"]},data:function(){return{content:"",fieldObj:{commun_type:"communtypeData"},statusData:[],communtypeData:["见面拜访","微信","钉钉"],projectData:[],displayStatus:f["default"].followStatusExamine,editInit:{selector:"#tinymce",mobile:{menubar:!0},language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",height:"400px",skin_url:"/tinymce/skins/ui/oxide"},value:"",imgRules:{minWidth:100,minHeight:100,maxSize:5},loading:!1,columnData:[],cateData:[],form:{name:"",content:"",project_id:""},rules:{name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],content:[{required:!0,message:"请输入日志内容",trigger:"blur"}],status:[{required:!0,message:"请输入日志状态",trigger:"blur"}]}}},created:function(){this.getTypes(),this.getProjects(),this.projectID&&(this.form.project_id=this.projectID)},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(){var r=v(i.a.mark(function r(n){var a,s,o,u;return i.a.wrap(function(r){while(1)switch(r.prev=r.next){case 0:if(!n){r.next=34;break}return t.loading=!0,r.prev=2,r.next=5,t.$refs.uploadImgs.getValue();case 5:return a=r.sent,t.form["img_urls"]=l["default"].solveUploadMultipleImg(a),t.form["customer_id"]=t.customerID,t.userCode&&(t.form["user_code"]=t.userCode),r.next=11,c["default"].addCustomerLog(t.form);case 11:s=r.sent,0===s.error_code&&(t.$message.success("".concat(s.msg)),t.resetForm(e),t.back()),r.next=31;break;case 15:if(r.prev=15,r.t0=r["catch"](2),!r.t0.data){r.next=30;break}if(o=r.t0.data.msg,!o||"object"!==d(o)){r.next=28;break}r.t1=i.a.keys(o);case 21:if((r.t2=r.t1()).done){r.next=28;break}return u=r.t2.value,t.$message.error(o[u]),r.next=26,setTimeout(function(){},1e3);case 26:r.next=21;break;case 28:r.next=31;break;case 30:t.$message.error(r.t0.toString());case 31:t.loading=!1,r.next=36;break;case 34:return t.$message.error("请填写正确的信息"),r.abrupt("return",!1);case 36:case"end":return r.stop()}},r,null,[[2,15]])}));return function(e){return r.apply(this,arguments)}}())},setStatusTypeField:function(){this.projectID?this.fieldObj["status"]="statusData":this.fieldObj["follow_status"]="statusData"},getTypes:function(){var e=v(i.a.mark(function e(){var t,r,n,a,s,o,u=this;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(n in this.setStatusTypeField(),t=[],r=this.fieldObj,r)t.push(n);return t=t.join(),e.next=7,p["default"].getTypeByField(t);case 7:if(a=e.sent,a&&0!=a.length){e.next=10;break}return e.abrupt("return");case 10:for(o in s=function(e){var t=r[e],n=a.find(function(t){return t["field"]==e});n&&(u[t]=n["value"])},r)s(o);case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getProjects:function(){var e=v(i.a.mark(function e(){var t,r,n=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:0,!(this.linkCode<=0)){e.next=4;break}return this.$message({type:"success",message:"客户错误"}),e.abrupt("return");case 4:return e.next=6,m["default"].getCustomerProjects(t,{},this.linkCode,0,20);case 6:if(r=e.sent,!(r.total_nums<=0)){e.next=10;break}return this.projectData=[],e.abrupt("return");case 10:this.projectData=r.collection;case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),resetForm:function(e){this.$refs[e].resetFields()},back:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$emit("close",e)}}},g=b,y=(r("d47c"),r("2877")),x=Object(y["a"])(g,n,a,!1,null,"399ed16d",null);t["default"]=x.exports}}]);